<!DOCTYPE html>
<html>
<head>
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='favicon.svg') }}">
    <title>Tea System</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>

<h2 style="text-align: center; background-color: rgb(241, 241, 241);">â˜• Tea / Coffee Orders</h2>


<div class="container">

<!-- ðŸ” LOGIN BUTTON -->
{% if not admin %}
<form method="POST" action="/login">
    <input type="password" name="password"
           placeholder="Enter password" required>
    <button type="submit">Login</button>
</form>
{% endif %}

<!-- ðŸ”“ ADMIN ORDER FORM -->
{% if admin %}
<form method="POST" class="order-form">
    <input type="text" name="name" placeholder="Customer Name" required>
    <input type="text" name="mobile" placeholder="Mobile Number" required>

    <select name="order" required>
        <option value="">Select Order</option>
        <option>Tea</option>
        <option>Coffee</option>
    </select>

    <button type="submit">Add Order</button>
</form>

<a href="/logout"><button>Logout</button></a>
{% endif %}

<!-- code for search bar start -->
<input type="text"
       id="searchInput"
       placeholder="Search customer name..."
       onkeyup="searchByName()"
       style="padding:8px; width:250px;">
<!-- code for search bar end -->

<!-- code for Filter start -->
 <div style="margin-bottom:10px;">
    <select id="salesFilter" onchange="applySalesFilter()">
        <option value="">Select Sales Filter</option>
        <option value="today">Today Sales</option>
        <option value="yesterday">Yesterday</option>
        <option value="last_week">Last Week</option>
        <option value="last_month">Last Month</option>
        <option value="custom">Custom Date</option>
    </select>

    <input type="date"
           id="customSalesDate"
           style="display:none; margin-left:8px;"
           onchange="filterCustomSalesDate()">
</div>

<!-- code for Filter end -->

</div>
<hr>

<!-- ðŸ“Š PUBLIC TABLE (Mobile hidden) -->
<table id="orderTable" border="1" cellpadding="6">
<tr>
    <th>Name</th>
    <th>Tea</th>
    <th>Coffee</th>
    <th>Visits</th>
    <th>Last Order</th>
    <th>Date</th>
    <th>Time</th>
</tr>

{% for o in orders %}
<tr>
    <td>{{ o[0] }}</td>
    <td>{{ o[1] }}</td>
    <td>{{ o[2] }}</td>
    <td>{{ o[3] }}</td>
    <td>{{ o[4] }}</td>
    <td>{{ o[5] }}</td>
    <td>{{ o[6] }}</td>
</tr>
{% endfor %}
</table>
<script>
    // for search bar script start 
    function searchByName() {
        let input = document.getElementById("searchInput").value.toLowerCase();
        let table = document.getElementById("orderTable");
        let rows = table.getElementsByTagName("tr");
        
        for (let i = 1; i < rows.length; i++) {
            let nameCell = rows[i].getElementsByTagName("td")[0];
            if (!nameCell) continue;
            
            let name = nameCell.textContent.toLowerCase();
            rows[i].style.display = name.includes(input) ? "" : "none";
        }
    }
    // for search bar script end

    
    // for filter script start
    function applySalesFilter() {
    let filter = document.getElementById("salesFilter").value;
    let rows = document.querySelectorAll("#orderTable tr");
    let today = new Date();
    today.setHours(0,0,0,0);

    let customInput = document.getElementById("customSalesDate");
    customInput.style.display = filter === "custom" ? "inline-block" : "none";

    rows.forEach((row, index) => {
        if (index === 0) return;

        let rowDate = new Date(row.cells[5].innerText.trim());
        rowDate.setHours(0,0,0,0);

        let diffDays = Math.floor((today - rowDate) / (1000 * 60 * 60 * 24));
        let show = false;

        if (filter === "today" && diffDays === 0) show = true;
        if (filter === "yesterday" && diffDays === 1) show = true;
        if (filter === "last_week" && diffDays <= 7) show = true;
        if (filter === "last_month" && diffDays <= 30) show = true;
        if (filter === "") show = true;

        if (filter !== "custom") {
            row.style.display = show ? "" : "none";
        }
    });
}

function filterCustomSalesDate() {
    let selected = document.getElementById("customSalesDate").value;
    if (!selected) return;

    let selectedDate = new Date(selected);
    selectedDate.setHours(0,0,0,0);

    let rows = document.querySelectorAll("#orderTable tr");

    rows.forEach((row, index) => {
        if (index === 0) return;

        let rowDate = new Date(row.cells[5].innerText.trim());
        rowDate.setHours(0,0,0,0);

        row.style.display =
            rowDate.getTime() === selectedDate.getTime()
            ? ""
            : "none";
    });
}
    // for filter script end


</script>

</body>
</html>
